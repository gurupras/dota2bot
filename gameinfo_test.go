package dota2bot

import (
	"encoding/json"
	"testing"

	"github.com/stretchr/testify/require"
)

const gameInfoString = `{"laneTypes":{"LANE_BOT":3,"LANE_MID":2,"LANE_NONE":0,"LANE_TOP":1},"gameTime":1761.5914306641,"runeStatusTypes":{"RUNE_STATUS_UNKNOWN":0,"RUNE_STATUS_AVAILABLE":1,"RUNE_STATUS_MISSING":2},"botModeTypes":{"BOT_MODE_FARM":17,"BOT_MODE_PUSH_TOWER_TOP":8,"BOT_MODE_NONE":0,"BOT_MODE_ROSHAN":20,"BOT_MODE_PUSH_TOWER_BOT":10,"BOT_MODE_ATTACK":2,"BOT_MODE_DEFEND_ALLY":18,"BOT_MODE_DEFEND_TOWER_MID":12,"BOT_MODE_SECRET_SHOP":5,"BOT_MODE_WARD":22,"BOT_MODE_RETREAT":4,"BOT_MODE_ITEM":21,"BOT_MODE_EVASIVE_MANEUVERS":19,"BOT_MODE_PUSH_TOWER_MID":9,"BOT_MODE_ASSEMBLE":14,"BOT_MODE_DEFEND_TOWER_BOT":13,"BOT_MODE_LANING":1,"BOT_MODE_TEAM_ROAM":16,"BOT_MODE_DEFEND_TOWER_TOP":11,"BOT_MODE_SIDE_SHOP":6,"BOT_MODE_ROAM":3},"abilityTargetFlagTypes":{"ABILITY_TARGET_FLAG_NOT_SUMMONED":4096,"ABILITY_TARGET_FLAG_NOT_ILLUSIONS":8192,"ABILITY_TARGET_FLAG_PREFER_ENEMIES":1048576,"ABILITY_TARGET_FLAG_RANGED_ONLY":2,"ABILITY_TARGET_FLAG_FOW_VISIBLE":128,"ABILITY_TARGET_FLAG_NOT_NIGHTMARED":524288,"ABILITY_TARGET_FLAG_OUT_OF_WORLD":262144,"ABILITY_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES":16,"ABILITY_TARGET_FLAG_NO_INVIS":256,"ABILITY_TARGET_FLAG_DEAD":8,"ABILITY_TARGET_FLAG_NOT_ANCIENTS":512,"ABILITY_TARGET_FLAG_NOT_ATTACK_IMMUNE":16384,"ABILITY_TARGET_FLAG_NONE":0,"ABILITY_TARGET_FLAG_MANA_ONLY":32768,"ABILITY_TARGET_FLAG_INVULNERABLE":64,"ABILITY_TARGET_FLAG_NOT_CREEP_HERO":131072,"ABILITY_TARGET_FLAG_PLAYER_CONTROLLED":1024,"ABILITY_TARGET_FLAG_NOT_MAGIC_IMMUNE_ALLIES":32,"ABILITY_TARGET_FLAG_MELEE_ONLY":4,"ABILITY_TARGET_FLAG_NOT_DOMINATED":2048,"ABILITY_TARGET_FLAG_CHECK_DISABLE_HELP":65536},"shrineTypes":{"SHRINE_BASE_3":2,"SHRINE_BASE_2":1,"SHRINE_BASE_1":0,"SHRINE_JUNGLE_1":3,"SHRINE_JUNGLE_2":4},"barrackTypes":{"BARRACKS_BOT_RANGED":5,"BARRACKS_TOP_RANGED":1,"BARRACKS_MID_RANGED":3,"BARRACKS_TOP_MELEE":0,"BARRACKS_BOT_MELEE":4,"BARRACKS_MID_MELEE":2},"abilityTargetTeamTypes":{"ABILITY_TARGET_TEAM_FRIENDLY":1,"ABILITY_TARGET_TEAM_NONE":0,"ABILITY_TARGET_TEAM_ENEMY":2},"towerTypes":{"TOWER_BASE_1":9,"TOWER_BOT_1":6,"TOWER_MID_1":3,"TOWER_TOP_1":0,"TOWER_MID_2":4,"TOWER_MID_3":5,"TOWER_TOP_3":2,"TOWER_BASE_2":10,"TOWER_TOP_2":1,"TOWER_BOT_3":8,"TOWER_BOT_2":7},"shopTypes":{"SHOP_HOME":0,"SHOP_SECRET2":5,"SHOP_SIDE2":4,"SHOP_SECRET":2,"SHOP_SIDE":1},"botModeDesireTypes":{"BOT_MODE_DESIRE_VERYLOW":0.10000000149012,"BOT_MODE_DESIRE_NONE":0,"BOT_MODE_DESIRE_LOW":0.25,"BOT_MODE_DESIRE_VERYHIGH":0.89999997615814,"BOT_MODE_DESIRE_ABSOLUTE":1,"BOT_MODE_DESIRE_HIGH":0.75,"BOT_MODE_DESIRE_MODERATE":0.5},"botActionTypes":{"BOT_ACTION_TYPE_PICK_UP_RUNE":7,"BOT_ACTION_TYPE_IDLE":1,"BOT_ACTION_TYPE_USE_ABILITY":6,"BOT_ACTION_TYPE_MOVE_TO_DIRECTLY":3,"BOT_ACTION_TYPE_NONE":0,"BOT_ACTION_TYPE_ATTACKMOVE":5,"BOT_ACTION_TYPE_PICK_UP_ITEM":8,"BOT_ACTION_TYPE_SHRINE":10,"BOT_ACTION_TYPE_DELAY":11,"BOT_ACTION_TYPE_ATTACK":4,"BOT_ACTION_TYPE_DROP_ITEM":9,"BOT_ACTION_TYPE_MOVE_TO":2},"botActionDesireTypes":{"BOT_ACTION_DESIRE_VERYLOW":0.10000000149012,"BOT_ACTION_DESIRE_LOW":0.25,"BOT_ACTION_DESIRE_NONE":0,"BOT_ACTION_DESIRE_HIGH":0.75,"BOT_ACTION_DESIRE_ABSOLUTE":1,"BOT_ACTION_DESIRE_MODERATE":0.5,"BOT_ACTION_DESIRE_VERYHIGH":0.89999997615814},"runeSpawn":{"RUNE_POWERUP_1":0,"RUNE_POWERUP_2":1,"RUNE_BOUNTY_2":3,"RUNE_BOUNTY_4":5,"RUNE_BOUNTY_3":4,"RUNE_BOUNTY_1":2},"ancientLocations":[null,{"y":-5351.9936523438,"x":-5919.9936523438,"z":239.99987792969},{"y":4999.998046875,"x":5527.9970703125,"z":248}],"runeSpawnLocations":{"0":{"y":984,"x":-1640,"z":48},"1":{"y":-1248,"x":1180,"z":64},"2":{"y":2572.0759277344,"x":-3852.0366210938,"z":64},"3":{"y":-74.268592834473,"x":-4122.6284179688,"z":304},"4":{"y":-2528.0324707031,"x":4031.9223632812,"z":60},"5":{"y":-463.92416381836,"x":3151.9633789062,"z":304}},"itemTypes":{"name":{"isItemPurchasedFromSideShop":false,"isItemPurchasedFromSecretShop":false,"name":"item_yasha","cost":2050}},"worldBounds":[-8288,-8288,8288,8288],"shopLocations":[null,{"0":{"y":-6171.169921875,"x":-7542.490234375,"z":416},"1":{"y":0,"x":0,"z":0},"2":{"y":-1207.6616210938,"x":4886.1411132812,"z":131},"4":{"y":0,"x":0,"z":0},"5":{"y":1947.9530029297,"x":-5080.1044921875,"z":130}},{"0":{"y":6809.2998046875,"x":6697.416015625,"z":258.20959472656},"1":{"y":0,"x":0,"z":0},"2":{"y":-1207.6616210938,"x":4886.1411132812,"z":131},"4":{"y":0,"x":0,"z":0},"5":{"y":1947.9530029297,"x":-5080.1044921875,"z":130}}],"abilityTargetTypes":{"ABILITY_TARGET_TYPE_COURIER":16,"ABILITY_TARGET_TYPE_OTHER":32,"ABILITY_TARGET_TYPE_BUILDING":4,"ABILITY_TARGET_TYPE_NONE":0,"ABILITY_TARGET_TYPE_TREE":64,"ABILITY_TARGET_TYPE_CREEP":2,"ABILITY_TARGET_TYPE_HERO":1,"ABILITY_TARGET_TYPE_BASIC":18,"ABILITY_TARGET_TYPE_ALL":55},"activityTypes":{"ACTIVITY_DIE":1506,"ACTIVITY_CHANNEL_ABILITY_4":1523,"ACTIVITY_ATTACK":1503,"ACTIVITY_DISABLED":1509,"ACTIVITY_CAST_ABILITY_2":1511,"ACTIVITY_ATTACK2":1504,"ACTIVITY_OVERRIDE_ABILITY_4":1519,"ACTIVITY_CHANNEL_END_ABILITY_6":1531,"ACTIVITY_CHANNEL_ABILITY_5":1524,"ACTIVITY_CHANNEL_ABILITY_1":1520,"ACTIVITY_CHANNEL_END_ABILITY_1":1526,"ACTIVITY_CHANNEL_END_ABILITY_2":1527,"ACTIVITY_OVERRIDE_ABILITY_1":1516,"ACTIVITY_ATTACK_EVENT":1505,"ACTIVITY_CHANNEL_ABILITY_6":1525,"ACTIVITY_CHANNEL_ABILITY_2":1521,"ACTIVITY_RUN":1502,"ACTIVITY_CAPTURE":1533,"ACTIVITY_FLAIL":1508,"ACTIVITY_CAST_ABILITY_6":1515,"ACTIVITY_FLINCH":1507,"ACTIVITY_OVERRIDE_ABILITY_3":1518,"ACTIVITY_CHANNEL_END_ABILITY_5":1530,"ACTIVITY_CAST_ABILITY_4":1513,"ACTIVITY_TAUNT":1536,"ACTIVITY_IDLE_RARE":1501,"ACTIVITY_CAST_ABILITY_3":1512,"ACTIVITY_SPAWN":1534,"ACTIVITY_CONSTANT_LAYER":1532,"ACTIVITY_CHANNEL_END_ABILITY_4":1529,"ACTIVITY_KILLTAUNT":1535,"ACTIVITY_IDLE":1500,"ACTIVITY_OVERRIDE_ABILITY_2":1517,"ACTIVITY_CAST_ABILITY_1":1510,"ACTIVITY_CHANNEL_ABILITY_3":1522,"ACTIVITY_CAST_ABILITY_5":1514,"ACTIVITY_CHANNEL_END_ABILITY_3":1528},"damageTypes":{"DAMAGE_TYPE_PHYSICAL":1,"DAMAGE_TYPE_ALL":7,"DAMAGE_TYPE_PURE":4,"DAMAGE_TYPE_MAGICAL":2},"dotaTime":1567.2121582031,"teams":[null,[{"isPlayerBot":true,"teamID":2,"playerID":2,"selectedHeroName":"npc_dota_hero_meepo"},{"isPlayerBot":true,"teamID":2,"playerID":3,"selectedHeroName":"npc_dota_hero_axe"},{"isPlayerBot":true,"teamID":2,"playerID":4,"selectedHeroName":"npc_dota_hero_bane"},{"isPlayerBot":true,"teamID":2,"playerID":5,"selectedHeroName":"npc_dota_hero_bloodseeker"},{"isPlayerBot":true,"teamID":2,"playerID":6,"selectedHeroName":"npc_dota_hero_crystal_maiden"}],[{"isPlayerBot":true,"teamID":3,"playerID":7,"selectedHeroName":"npc_dota_hero_drow_ranger"},{"isPlayerBot":true,"teamID":3,"playerID":8,"selectedHeroName":"npc_dota_hero_earthshaker"},{"isPlayerBot":true,"teamID":3,"playerID":9,"selectedHeroName":"npc_dota_hero_juggernaut"},{"isPlayerBot":true,"teamID":3,"playerID":10,"selectedHeroName":"npc_dota_hero_mirana"},{"isPlayerBot":true,"teamID":3,"playerID":11,"selectedHeroName":"npc_dota_hero_nevermore"}]],"teamTypes":{"TEAM_DIRE":3,"TEAM_NONE":5,"TEAM_RADIANT":2,"TEAM_NEUTRAL":4},"itemSlotTypes":{"ITEM_SLOT_TYPE_STASH":2,"ITEM_SLOT_TYPE_INVALID":-1,"ITEM_SLOT_TYPE_MAIN":0,"ITEM_SLOT_TYPE_BACKPACK":1},"courierActionTypes":{"COURIER_ACTION_TRANSFER_ITEMS":4,"COURIER_ACTION_TAKE_STASH_ITEMS":3,"COURIER_ACTION_SECRET_SHOP":1,"COURIER_ACTION_SIDE_SHOP2":9,"COURIER_ACTION_RETURN":0,"COURIER_ACTION_TAKE_AND_TRANSFER_ITEMS":6,"COURIER_ACTION_ENEMY_SECRET_SHOP":7,"COURIER_ACTION_BURST":5,"COURIER_ACTION_SIDE_SHOP":8},"runeTypes":{"RUNE_INVALID":-1,"RUNE_DOUBLEDAMAGE":0,"RUNE_BOUNTY":5,"RUNE_REGENERATION":4,"RUNE_INVISIBILITY":3,"RUNE_ARCANE":6,"RUNE_ILLUSION":2,"RUNE_HASTE":1},"courierStateTypes":{"COURIER_STATE_IDLE":0,"COURIER_STATE_MOVING":2,"COURIER_STATE_DEAD":5,"COURIER_STATE_RETURNING_TO_BASE":4,"COURIER_STATE_AT_BASE":1,"COURIER_STATE_DELIVERING_ITEMS":3}}`

func TestGameInfoParsing(t *testing.T) {
	require := require.New(t)

	var gi GameInfo

	err := json.Unmarshal([]byte(gameInfoString), &gi)
	require.Nil(err)

	require.Equal(3, gi.LaneTypes.Bot)
}
